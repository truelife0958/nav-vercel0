<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯†ç é‡ç½®å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      padding: 40px;
      max-width: 500px;
      width: 100%;
    }
    h1 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      color: #4a5568;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }
    input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    .help-text {
      margin-top: 6px;
      font-size: 12px;
      color: #718096;
    }
    button {
      width: 100%;
      padding: 14px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #5568d3;
    }
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      display: none;
    }
    .result.success {
      background: #c6f6d5;
      border: 1px solid #9ae6b4;
      color: #22543d;
      display: block;
    }
    .result.error {
      background: #fed7d7;
      border: 1px solid #fc8181;
      color: #742a2a;
      display: block;
    }
    .result h3 {
      margin-bottom: 10px;
      font-size: 16px;
    }
    .result pre {
      background: rgba(0,0,0,0.05);
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 10px;
    }
    .credentials {
      margin-top: 12px;
      padding: 12px;
      background: rgba(0,0,0,0.05);
      border-radius: 6px;
    }
    .credentials p {
      margin: 6px 0;
      font-family: monospace;
    }
    .warning {
      background: #fef5e7;
      border: 1px solid #f9ca24;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #856404;
    }
    .warning strong {
      display: block;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ç®¡ç†å‘˜å¯†ç é‡ç½®</h1>
    <p class="subtitle">é‡ç½®Verceléƒ¨ç½²çš„ç®¡ç†å‘˜å¯†ç </p>
    
    <div class="warning">
      <strong>âš ï¸ å®‰å…¨æç¤º</strong>
      æ­¤å·¥å…·ä»…ç”¨äºä¸€æ¬¡æ€§å¯†ç é‡ç½®ã€‚é‡ç½®æˆåŠŸåï¼Œè¯·ç«‹å³åˆ é™¤æ­¤æ–‡ä»¶ï¼
    </div>

    <form id="resetForm">
      <div class="form-group">
        <label for="jwtSecret">JWTå¯†é’¥ *</label>
        <input 
          type="text" 
          id="jwtSecret" 
          placeholder="è¾“å…¥Vercelç¯å¢ƒå˜é‡ä¸­çš„JWT_SECRET"
          required
        >
        <p class="help-text">åœ¨Vercelé¡¹ç›®è®¾ç½® â†’ Environment Variables ä¸­æŸ¥çœ‹</p>
      </div>

      <button type="submit" id="submitBtn">é‡ç½®å¯†ç </button>
    </form>

    <div id="result" class="result"></div>
  </div>

  <script>
    const form = document.getElementById('resetForm');
    const resultDiv = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const jwtSecret = document.getElementById('jwtSecret').value.trim();
      
      if (!jwtSecret) {
        showError('è¯·è¾“å…¥JWTå¯†é’¥');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'å¤„ç†ä¸­...';
      resultDiv.style.display = 'none';

      try {
        const response = await fetch('/api/reset-admin-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            secret_key: jwtSecret
          })
        });

        const data = await response.json();

        if (response.ok) {
          showSuccess(data);
        } else {
          showError(data.error || 'é‡ç½®å¤±è´¥');
        }
      } catch (error) {
        showError('ç½‘ç»œé”™è¯¯: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'é‡ç½®å¯†ç ';
      }
    });

    function showSuccess(data) {
      resultDiv.className = 'result success';
      resultDiv.innerHTML = `
        <h3>âœ… ${data.message}</h3>
        <div class="credentials">
          <p><strong>ç”¨æˆ·å:</strong> ${data.username}</p>
          <p><strong>å¯†ç :</strong> ${data.password}</p>
        </div>
        <p style="margin-top: 16px; font-size: 14px;">
          ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šè¿°å‡­æ®ç™»å½•åå°ç®¡ç†ç³»ç»Ÿäº†ã€‚
        </p>
        <p style="margin-top: 12px; font-size: 13px; color: #c53030;">
          <strong>é‡è¦ï¼š</strong>è¯·ç«‹å³åˆ é™¤ web/reset-password.html å’Œ routes/reset-admin-password.js æ–‡ä»¶ï¼
        </p>
      `;
    }

    function showError(message) {
      resultDiv.className = 'result error';
      resultDiv.innerHTML = `
        <h3>âŒ é‡ç½®å¤±è´¥</h3>
        <p>${message}</p>
        <p style="margin-top: 12px; font-size: 13px;">
          è¯·æ£€æŸ¥ï¼š<br>
          1. JWTå¯†é’¥æ˜¯å¦æ­£ç¡®<br>
          2. Verceléƒ¨ç½²æ˜¯å¦æˆåŠŸ<br>
          3. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
        </p>
      `;
    }
  </script>
</body>
</html>